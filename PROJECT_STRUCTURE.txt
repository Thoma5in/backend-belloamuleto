================================================================================
âœ… BACKEND BELLO AMULETO - ESTRUCTURA COMPLETA
================================================================================

ğŸ“¦ backend-belloamuleto/
â”‚
â”œâ”€â”€ ğŸ“„ package.json                    # Dependencias del proyecto
â”œâ”€â”€ ğŸ“„ .env.example                    # Template de variables de entorno
â”œâ”€â”€ ğŸ“„ .gitignore                      # Archivos ignorados por Git
â”‚
â”œâ”€â”€ ğŸ“š DOCUMENTACIÃ“N
â”‚   â”œâ”€â”€ ğŸ“„ README.md                   # Inicio rÃ¡pido y resumen
â”‚   â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md             # Arquitectura completa y detallada
â”‚   â”œâ”€â”€ ğŸ“„ QUICK_GUIDE.md              # GuÃ­a para agregar features
â”‚   â”œâ”€â”€ ğŸ“„ DECISIONS.md                # Decisiones arquitectÃ³nicas
â”‚   â”œâ”€â”€ ğŸ“„ EXAMPLES.md                 # Ejemplos de uso de la API
â”‚   â”œâ”€â”€ ğŸ“„ database-setup.sql          # Script SQL para crear tablas
â”‚   â””â”€â”€ ğŸ“„ api-tests.http              # Tests HTTP (REST Client)
â”‚
â””â”€â”€ ğŸ“ src/
    â”‚
    â”œâ”€â”€ ğŸ“„ server.js                   # Punto de entrada (inicio del servidor)
    â”œâ”€â”€ ğŸ“„ app.js                      # ConfiguraciÃ³n de Express
    â”‚
    â”œâ”€â”€ ğŸ“ config/                     # CAPA DE INFRAESTRUCTURA
    â”‚   â”œâ”€â”€ database.js                # âœ¨ AbstracciÃ³n del cliente BD (singleton)
    â”‚   â”œâ”€â”€ supabase.js                # Cliente de Supabase
    â”‚   â””â”€â”€ jwt.js                     # ConfiguraciÃ³n JWT
    â”‚
    â”œâ”€â”€ ğŸ“ repositories/               # CAPA DE ACCESO A DATOS
    â”‚   â”œâ”€â”€ BaseRepository.js          # âœ¨ Repository base con CRUD genÃ©rico
    â”‚   â””â”€â”€ ProductRepository.js       # Repository de productos (ejemplo)
    â”‚
    â”œâ”€â”€ ğŸ“ services/                   # CAPA DE LÃ“GICA DE NEGOCIO
    â”‚   â””â”€â”€ ProductService.js          # âœ¨ Servicio de productos con validaciones
    â”‚
    â”œâ”€â”€ ğŸ“ controllers/                # CAPA DE PRESENTACIÃ“N (HTTP)
    â”‚   â””â”€â”€ ProductController.js       # Controlador HTTP de productos
    â”‚
    â”œâ”€â”€ ğŸ“ routes/                     # DEFINICIÃ“N DE RUTAS
    â”‚   â”œâ”€â”€ index.js                   # Router principal
    â”‚   â””â”€â”€ productRoutes.js           # Rutas de productos
    â”‚
    â”œâ”€â”€ ğŸ“ middlewares/                # MIDDLEWARES DE EXPRESS
    â”‚   â”œâ”€â”€ errorHandler.js            # âœ¨ Manejo centralizado de errores
    â”‚   â””â”€â”€ logger.js                  # Logger de peticiones HTTP
    â”‚
    â””â”€â”€ ğŸ“ utils/                      # UTILIDADES
        â””â”€â”€ errors.js                  # âœ¨ Clases de errores personalizados

================================================================================
ğŸ—ï¸ FLUJO DE UNA PETICIÃ“N (Ejemplo: GET /api/products/123)
================================================================================

1ï¸âƒ£  HTTP Request
    â†“
2ï¸âƒ£  ROUTES (productRoutes.js)
    â””â”€ router.get('/:id', productController.getProductById)
    â†“
3ï¸âƒ£  CONTROLLER (ProductController.js)
    â”œâ”€ Extrae parÃ¡metros: const { id } = req.params
    â”œâ”€ Llama al service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€ Formatea respuesta HTTP                              â†“
    â†‘                                                        â†“
    â”‚                                                4ï¸âƒ£  SERVICE (ProductService.js)
    â”‚                                                    â”œâ”€ Valida ID (regla de negocio)
    â”‚                                                    â”œâ”€ Llama al repository â”€â”€â”€â”€â”€â”€â”
    â”‚                                                    â”œâ”€ Enriquece datos            â†“
    â”‚                                                    â””â”€ Retorna datos procesados   â†“
    â”‚                                                    â†‘                             â†“
    â”‚                                                    â”‚                     5ï¸âƒ£  REPOSITORY (ProductRepository.js)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”œâ”€ Construye query
                                                         â”‚                         â”œâ”€ Ejecuta en Supabase â”€â”€â”
                                                         â”‚                         â””â”€ Retorna datos raw     â†“
                                                         â”‚                         â†‘                        â†“
                                                         â”‚                         â”‚                6ï¸âƒ£  CONFIG (database.js)
                                                         â”‚                         â”‚                    â””â”€ Cliente Supabase
                                                         â”‚                         â”‚                    â†‘
                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                                                                                                       7ï¸âƒ£  SUPABASE
                                                                                                           â””â”€ PostgreSQL
8ï¸âƒ£  HTTP Response
    â””â”€ { success: true, data: { ...producto... } }

================================================================================
ğŸ“‹ RESPONSABILIDADES POR CAPA
================================================================================

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ CAPA           â•‘ âœ… SÃ DEBE HACER              â•‘ âŒ NO DEBE HACER          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Controllers    â•‘ â€¢ Extraer params/body/query  â•‘ â€¢ LÃ³gica de negocio       â•‘
â•‘                â•‘ â€¢ Validar formato HTTP       â•‘ â€¢ Acceso directo a BD     â•‘
â•‘                â•‘ â€¢ Llamar a services          â•‘ â€¢ CÃ¡lculos complejos      â•‘
â•‘                â•‘ â€¢ Formatear respuestas HTTP  â•‘                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Services       â•‘ â€¢ LÃ³gica de negocio          â•‘ â€¢ Conocer HTTP            â•‘
â•‘                â•‘ â€¢ Validaciones de reglas     â•‘ â€¢ Acceso directo a BD     â•‘
â•‘                â•‘ â€¢ Orquestar repositories     â•‘ â€¢ Usar req/res            â•‘
â•‘                â•‘ â€¢ Transformar/enriquecer     â•‘                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Repositories   â•‘ â€¢ CRUD operations            â•‘ â€¢ LÃ³gica de negocio       â•‘
â•‘                â•‘ â€¢ Queries a BD               â•‘ â€¢ Validaciones de negocio â•‘
â•‘                â•‘ â€¢ Mapeo de datos             â•‘ â€¢ Conocer HTTP            â•‘
â•‘                â•‘ â€¢ Manejo de errores de BD    â•‘                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Config         â•‘ â€¢ Inicializar conexiones     â•‘ â€¢ LÃ³gica de negocio       â•‘
â•‘                â•‘ â€¢ Variables de entorno       â•‘ â€¢ Operaciones de datos    â•‘
â•‘                â•‘ â€¢ Clientes singleton         â•‘                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

================================================================================
ğŸ¯ ARCHIVOS CLAVE Y SU PROPÃ“SITO
================================================================================

âœ¨ BaseRepository.js
   â””â”€ Implementa CRUD genÃ©rico (findAll, findById, create, update, delete)
   â””â”€ Todos los repositories heredan de esta clase
   â””â”€ DECISIÃ“N: Evita duplicar cÃ³digo CRUD en cada entidad

âœ¨ database.js
   â””â”€ Abstrae el cliente de Supabase
   â””â”€ DECISIÃ“N: Cambiar de BD solo requiere modificar este archivo

âœ¨ ProductService.js
   â””â”€ Contiene TODA la lÃ³gica de negocio
   â””â”€ Ejemplos: validaciones, cÃ¡lculos, reglas del dominio
   â””â”€ DECISIÃ“N: Independiente de HTTP y de la BD

âœ¨ errorHandler.js
   â””â”€ Middleware que captura todos los errores
   â””â”€ Formatea respuestas consistentes
   â””â”€ DECISIÃ“N: Un solo lugar para manejar errores

âœ¨ errors.js
   â””â”€ Clases de errores tipados (NotFoundError, ValidationError, etc.)
   â””â”€ DECISIÃ“N: Facilita identificar y manejar diferentes tipos de errores

================================================================================
ğŸ“¡ ENDPOINTS IMPLEMENTADOS
================================================================================

GET    /                                    â†’ Info de la API
GET    /api/health                          â†’ Health check

GET    /api/products                        â†’ Listar productos (paginaciÃ³n/filtros)
GET    /api/products/:id                    â†’ Obtener producto por ID
GET    /api/products/search?q=tÃ©rmino       â†’ Buscar productos
GET    /api/products/category/:category     â†’ Productos por categorÃ­a
GET    /api/products/low-stock              â†’ Productos con stock bajo
POST   /api/products                        â†’ Crear producto
PUT    /api/products/:id                    â†’ Actualizar producto
PATCH  /api/products/:id/stock              â†’ Actualizar solo stock
DELETE /api/products/:id                    â†’ Eliminar producto (soft delete)

================================================================================
ğŸ› ï¸ TECNOLOGÃAS Y DEPENDENCIAS
================================================================================

â”œâ”€ express              â†’ Framework web
â”œâ”€ @supabase/supabase-js â†’ SDK de Supabase
â”œâ”€ dotenv               â†’ Variables de entorno
â””â”€ nodemon              â†’ Auto-reload en desarrollo (devDependency)

================================================================================
âš™ï¸ COMANDOS DISPONIBLES
================================================================================

npm install             # Instalar dependencias
npm run dev             # Desarrollo con auto-reload
npm start               # ProducciÃ³n

================================================================================
ğŸ” VARIABLES DE ENTORNO REQUERIDAS
================================================================================

SUPABASE_URL                â†’ URL de tu proyecto Supabase
SUPABASE_SERVICE_ROLE_KEY   â†’ Service role key de Supabase
PORT                        â†’ Puerto del servidor (default: 3000)
NODE_ENV                    â†’ Entorno: development | production

================================================================================
âœ¨ CARACTERÃSTICAS DESTACADAS
================================================================================

âœ… Arquitectura en capas (4 capas bien definidas)
âœ… Desacoplamiento total de Supabase (fÃ¡cil cambiar BD)
âœ… BaseRepository reutilizable para todas las entidades
âœ… Manejo de errores centralizado y robusto
âœ… Soft delete (no se pierden datos)
âœ… Validaciones en mÃºltiples capas
âœ… Dependency Injection (testing fÃ¡cil)
âœ… Singleton patterns correctamente implementados
âœ… Async/await en todas las capas
âœ… DocumentaciÃ³n exhaustiva
âœ… Ejemplos de uso completos
âœ… SQL scripts incluidos

================================================================================
ğŸ“– DOCUMENTACIÃ“N RECOMENDADA SEGÃšN TU NECESIDAD
================================================================================

ğŸ†• Nuevo en el proyecto?
   â””â”€ Lee: README.md â†’ ARCHITECTURE.md

ğŸ’» Agregar funcionalidades?
   â””â”€ Lee: QUICK_GUIDE.md

ğŸ¤” Entender decisiones tÃ©cnicas?
   â””â”€ Lee: DECISIONS.md

ğŸ§ª Testear la API?
   â””â”€ Usa: api-tests.http (con REST Client de VS Code)

ğŸ—„ï¸ Configurar base de datos?
   â””â”€ Ejecuta: database-setup.sql en Supabase

ğŸ“¡ Consumir desde frontend?
   â””â”€ Lee: EXAMPLES.md

================================================================================
ğŸš€ INICIO RÃPIDO (3 PASOS)
================================================================================

1. Configurar ambiente:
   cp .env.example .env
   # Editar .env con credenciales de Supabase

2. Crear tabla en Supabase:
   # Ejecutar database-setup.sql en SQL Editor

3. Iniciar servidor:
   npm install
   npm run dev

Â¡Listo! API corriendo en http://localhost:3000

================================================================================
ğŸ“ PRINCIPIOS APLICADOS
================================================================================

âœ“ SOLID (especialmente Single Responsibility)
âœ“ DRY (Don't Repeat Yourself)
âœ“ KISS (Keep It Simple, Stupid)
âœ“ Separation of Concerns
âœ“ Dependency Injection
âœ“ Clean Architecture

================================================================================
ğŸ”® EVOLUCIÃ“N FUTURA SUGERIDA
================================================================================

1. âœ… Migrar a TypeScript
2. âœ… Agregar testing (Jest)
3. âœ… Implementar autenticaciÃ³n JWT
4. âœ… Agregar validaciÃ³n de schemas (Zod/Joi)
5. âœ… Documentar con OpenAPI/Swagger
6. âœ… Rate limiting
7. âœ… Logging avanzado (Winston/Pino)
8. âœ… Cache con Redis
9. âœ… CI/CD
10. âœ… Monitoring y alertas

================================================================================
âœ… PROYECTO COMPLETADO Y LISTO PARA USAR
================================================================================

Todo estÃ¡ implementado y documentado. Puedes empezar a desarrollar
manteniendo la arquitectura limpia y escalable.

Â¡Feliz codificaciÃ³n! ğŸš€
